
@{
    ViewData["Title"] = "Quyet_dinh_sua_chua";
    Layout = "~/Views/Shared/_Layout_CDVT.cshtml";
}
@{
    List<string> right = (List<string>)Session["RightIDs"];
}
<link href="~/assets/Custom css/CDVT/TABLE_BORDERED.css" rel="stylesheet" />
<link href="~/lib/datepicker_src/dist/css/datepicker.min.css" rel="stylesheet" type="text/css">
<link href="~/lib/datepicker_src/css/style.css" rel="stylesheet " type="text/css ">
<link href="~/lib/datepicker_src/dist/css/datepicker.min.css " rel="stylesheet " type="text/css ">
<link href="~/lib/datepicker_src/dist/css/custom.css " rel="stylesheet " type="text/css ">
<link href="~/lib/datepicker_src/dist/css/font.css" rel="stylesheet" type="text/css">
<script src="~/lib/datepicker_src/dist/js/datepicker.js"></script>
<script src="~/lib/datepicker_src/dist/js/i18n/datepicker.vi.js"></script>
<div class="card">
    <div class="card-content">
        <div class="row">
            <div class="col s12">
                <div class="center">
                    <h3>
                        <b>DANH SÁCH QUYẾT ĐỊNH SỬA CHỮA</b>
                    </h3>
                    <div class="col l6 m6 s12">
                        <div class="row">
                            <div class="col l8 m8 s12 offset-l1 offset-m1 input-field">
                                <input type="text" placeholder="Tìm kiếm theo số quyết định" class='form-control' id="searchArea"
                                       multiple />
                            </div>
                            <div class="col l8 m8 s12 offset-l1 offset-m1 input-field">
                                <input type="text" placeholder="Tìm kiếm theo tên người lập quyết định" class='form-control' id="searchArea"
                                       multiple />
                            </div>
                            <div class="col l8 m8 s12 offset-l1 offset-m1 input-field">
                                <input type="text" placeholder="Tìm kiếm theo tên người phê duyệt" class='form-control' id="searchArea"
                                       multiple />
                            </div>
                        </div>
                    </div>
                    <div class="col l6 m6 s12">
                        <div class="row center">
                            <div class="col l10 m10 s12 offset-l1 offset-m1 input-field">
                                <i class="fas fa-calendar-alt icon"></i>
                                <input type='text' class='datepicker-here center' id="minMaxDate" data-language='vi' value="Ngày ra quyết định (từ)" style="height: 24px" />
                            </div>
                            <div class="col l10 m10 s12 offset-l1 offset-m1 input-field">
                                <i class="fas fa-calendar-alt icon"></i>
                                <input type='text' class='datepicker-here center' id="minMaxDate" data-language='vi' value="Ngày ra quyết định (đến)" style="height: 24px" />
                            </div>
                            <div class="col l8 m8 s6 offset-l2 offset-m2 input-field">
                                <button class="btn blue darken-2 btn-small" id="searchButton1">Tìm kiếm</button>
                            </div>
                        </div>
                    </div>
                    <div class="col l12 m12 s6">
                        <button class="btn blue darken-2 btn-small" id="searchButton2">Tìm kiếm</button>
                    </div>
                </div>
                <div class="col s12 left" style="margin-bottom:20px">
                 
                                <a href="/phong-cdvt/sua-chua" class="waves-effect waves-light btn blue darken-1 blue">Thêm</a>

                     
                    <a href="javascript:void(0);" id="ExportExcel" class="waves-effect waves-light btn blue darken-1 blue">Xuất Excel</a>
                </div>
                <div class="col s12">
                    <table id="DocumnetaryTable" class="striped centered responsive-table mytable table-bordered">






                        <thead>
                            <tr>
                                <th class="center">Ngày quyết định</th>
                                <th class="center">Số quyết định</th>
                                <th class="center">Người lập quyết định</th>
                                <th class="center">Số lượng thiết bị</th>
                                <th class="center">Lý do quyết định</th>
                                <th class="center">Nguồn vốn</th>
                                <th></th>
                            </tr>
                        </thead>

                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="myedit">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Sửa quyết định sửa chữa</h3>
        </div>
        <div class="modal-body">
            <div class="modal-body" id="edit-modal-body">
            </div>
            <br />


            <div class="modal-footer">

            </div>
        </div>
    </div>
</div>
<div id="update" class="modal">
    <div class="modal-header center-align">
        <h3>Cập nhật mã quyết định</h3>
    </div>
    <div class="modal-body">
        <div class="row">
            <div class="col s3 offset-s2 right-align">
                Mã quyết định
            </div>
            <div class="col s3">
                <input class="form-control" type="text" />
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <td style="text-align:center">
            <a href="#myaleart" class="waves-effect waves-light btn red modal-trigger">Xoá bản nháp này</a>
        </td>
        <button type="submit" class="btn blue darken-2 modal-close save-category">Lưu</button>
        <button type="button" class="btn light-blue lighten-1 modal-close">Thoát</button>
    </div>
</div>
<div id="myaleart" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Xác nhận xóa mục này</h3>
        </div>
        <div class="modal-body">
            <p class="red-text">Dữ liệu không thể phục hồi sau thao tác này</p>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn blue darken-2 modal-close">Xóa</button>
            <button type="button" class="btn red modal-close">Hủy</button>
        </div>
    </div>
</div>
<script>
    $(window).resize(function () {
        if ($(window).width() <= 600) {
            $("#searchButton1").hide();
            $("#searchButton2").show();
        } else {
            $("#searchButton1").show();
            $("#searchButton2").hide();
        }
    });
</script>
<link href="//cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css" rel="stylesheet" />
@section scripts{
    <script src="//cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script>
        var Popup, dataTable;

        $(document).ready(function () {

            dataTable = $('#DocumnetaryTable').DataTable({
                "ajax": {
                    "url": "/phong-cdvt/quyet-dinh/sua-chua",
                    "type": "POST",
                    "datatype": "json",
                },
                "columns": [

                    {
                        "data": "date_created", "name": "date_created", "render": function (data) {
                            return dateFormat2(data);
                        },
                    },
                    {
                        "data": "documentary_id", "name":"documentary_id","render": function (data) {
                            return "<a  onclick=GetData('@Url.Action("LoadPage","ChitietKiemdinh")?id=" + data + "')> " + data +"</a>";
                     },
                        "orderable": true,
                        "searchable":false,
                    },
                    { "data": "person_created", "name": "person_created" },
                    { "data": "count", "name": "count" },
                    { "data": "reason" , "name" : "reason"},
                    { "data": "out_in_come" , "name" :"out_in_come" },
                    {
                        "data": "documentary_id", "render": function (data) {
                             return "<a class='btn btn-default btn-sm modal-trigger' data-target='myedit'onclick=Edit('@Url.Action("Edit","suachuaQD")/" + data + "')>Chỉnh Sửa</a>";
                                    },
                        "orderable": false,
                        "searchable":false,

                    }
                ],
                "serverSide": "true",
                "order" : [0, "asc"]
            });
        });


        function PopupForm(url) {
            var formDiv = $('<div/>');
            $.get(url)
            .done(function (response) {
                formDiv.html(response);

                Popup = formDiv.dialog({
                    autoOpen: true,
                    resizable: false,
                    title: 'Nhập thông tin',
                    height: 1000,
                    width: 800,
                    close: function () {
                        Popup.dialog('destroy').remove();
                    }

                });
            });
        }

        function UpdateEquipment(form) {
             $.ajax({
                 type: 'POST',
                 url: form.action,
                success: function (response) {
                    dataTable.ajax.reload();
                    $.notify("Cập nhật thành công",{
                       globalPosition :"top center",
                       className : "success"
                    })
                }
            });
        }

        function SubmitForm(form) {
            $.validator.unobtrusive.parse(form);
            if($(form).valid()){
                $.ajax({
                    type : "POST",
                    url : form.action,
                    data : $(form).serialize(),
                    success : function (data) {
                            dataTable.ajax.reload();

                            $.notify(data.message,{
                                globalPosition :"top center",
                                className : "success"
                            })

                        }
                });
            }
            return false;
        }
            function Edit(url) {
             $.get(url)
                 .done(function (response) {
                     $("#edit-modal-body").html(response)
            });
                return false;
        }

        function Delete(url) {
             $.get(url)
                 .done(function (response) {
                     dataTable.ajax.reload();
                     $.notify("Hihi Xóa Xong", {
                         globalPosition: "top center",
                         className: "success"
                     })
                 });
                return false;

        }
        function GetData(url) {
            window.location.href = url;
        }

        $("#ExportExcel").click(function () {
            $.ajax({
                url: '@Url.Action("ExportExcel","suachuaQD")',
                type: 'POST',
                success: {

                },
                error: {

                },

            }).done(function () {
                window.location.href = "/excel/CDVT/download/DanhsachSuaChua.xlsx"
            })
        });

        function dateFormat2(d) {
            var dateString = d.substr(6);
            var currentTime = new Date(parseInt(dateString));
            var month = currentTime.getMonth() + 1;
            var day = currentTime.getDate();
            var year = currentTime.getFullYear();
            var date = day + "/" + month + "/" + year;
            return (date);
        }
    </script>
}