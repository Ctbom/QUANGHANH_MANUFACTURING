@{
    ViewData["Title"] = "List";
    Layout = "~/Views/Shared/_Layout_TCLD.cshtml";
}
<link href="~/assets/Custom css/TCLD/Certificate/Certificate.css" rel="stylesheet" />
<link href="~/lib/mutiple select/slimselect.css" rel="stylesheet" />
<div class="user-roll card" id="vld-antoan">
    <div class="card-content">
        <div class="row">
            <h3 class="black-text"><b>DANH SÁCH CHỨNG CHỈ LAO ĐỘNG</b></h3>
            <div class="center">
                <div class="col s12 m12 l5 input-field">
                    @Html.Action("SearchCertificate", "Certificate")
                </div>

                <div class="col l2 m12 s12 input-field">
                    <button class="btn blue darken-2 btn-small" id="searchButton">Tìm kiếm</button>
                </div>
            </div>
        </div>
        <hr />
        <div class="col s12 m12 l12">

            <ul class="tabs">
                <li class="tab col m6 l6 s12"><a href="#chungchicongty" >Chứng chỉ của cả công ty</a></li>
                <li class="tab col m6 l6 s12"><a href="#chungchicuanhanvien">Chứng chỉ của nhân viên</a></li>
            </ul>
        </div>
        <!---->
        <div id="chungchicongty">
            <div class="row">
                <div class="card">
                    <div class="card-content">
                        <div class="row">
                            <a class="btn btn-small blue darken-2 modal-trigger btn-mg" data-target="myadd">Thêm chứng chỉ</a>
                            <a class="btn btn-small blue darken-2 btn-mg" href="~/excel/TCLD/Certificate/Chứng chỉ của cả công ty.xlsx">Xuất ra file excel</a>
                        </div>
                        <div class="table-responsive">
                            <table id="table_chungchi" class="table table-bordered  centered highlight">
                                <thead>
                                    <tr>
                                        <th>Mã chứng chỉ</th>
                                        <th>Tên chứng chỉ</th>
                                        <th>Thời hạn</th>
                                        <th>Kiểu chứng chỉ</th>
                                        <th></th>
                                        <th></th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
        <!---->
        <div id="chungchicuanhanvien">
            <div class="row">
                <div class="card">
                    <div class="card-content">
                        <div class="row">
                            <a class="btn btn-small blue darken-2 modal-trigger btn-mg" data-target="add_cir_emp">Thêm chứng chỉ cho 1 nhân viên</a>
                            <a class="btn btn-small blue darken-2 btn-mg" href="~/excel/TCLD/Certificate/Chứng chỉ của cả công ty.xlsx">Xuất ra file excel</a>
                        </div>
                        <div class="table-responsive">
                            <table id="table_cirt_emp" class="table table-bordered  centered highlight">
                                <thead>
                                    <tr>
                                        <th>Số hiệu</th>
                                        <th>Tên nhân viên</th>
                                        <th>Tên chứng chỉ</th>
                                        <th>Ngày cấp</th>
                                        <th></th>
                                        <th></th>
                                    </tr>
                                </thead>
                            </table>
                            <br />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="myadd" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Thêm Chứng Chỉ</h3>
        </div>
        <div class="modal-body">
            @Html.Action("AddCertificate", "Certificate")
        </div>
    </div>
</div>
<div id="add_cir_emp" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Thêm Chứng Chỉ</h3>
        </div>
        <div class="modal-body">
            @Html.Action("AddCertificateEmployee", "Certificate")
        </div>
    </div>
</div>
<div id="myedit" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Thêm Chứng Chỉ</h3>
        </div>
        <div class="modal-body">
            @Html.Action("EditCertificate", "Certificate")
        </div>
    </div>
</div>
<div id="edit_employee" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Thêm Chứng Chỉ</h3>
        </div>
        <div class="modal-body">
            @Html.Action("EditCertificateEmp", "Certificate")
        </div>
    </div>
</div>
<div id="mydelete" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Xác nhận xóa chứng chỉ</h3>
        </div>
        <div class="modal-body">
            <p class="red-text">Bạn có muốn xóa chứng chỉ này?</p>
        </div>
        <div class="modal-footer">
            <a class="btn blue darken-2 modal-close" onclick="Delete()">Xóa</a>
            <a class="btn red modal-close">Hủy</a>
        </div>
    </div>
</div>
<div id="delete_employee" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Xác nhận xóa chứng chỉ của nhân viên</h3>
        </div>
        <div class="modal-body">
            <p class="red-text">Bạn có muốn xóa chứng chỉ này?</p>
        </div>
        <div class="modal-footer">
            <a class="btn blue darken-2 modal-close" onclick="DeleteEmp()">Xóa</a>
            <a class="btn red modal-close">Hủy</a>
        </div>
    </div>
</div>
<p>
    @ViewBag.hihi
</p>
<link href="//cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css" rel="stylesheet" />
<script src="~/js/Custom JS/TCLD/Certificate/certificate.js"></script>
<script src="~/js/Custom JS/form-input-border.js"></script>
<script src="~/js/notify.min.js"></script>
<script src="~/lib/mutiple select/slimselect.js"></script>
<script src="//cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>

@section scripts{
    <script src="//cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script>
        var Popup, dataTable, dataCertificateEmp;
        var editID, deleteId;
        var editIDEmp, deleteIdEmp;
        var searchId;
        $(document).ready(function () {
            dataTable = $("#table_chungchi").DataTable({

                "ajax": {
                    "url": "/phong-tcld/chung-chi/danh-sach-chung-chi",
                    "type": "POST",
                    "datatype": "json",
                },
                "columns": [
                    { "data": "MaChungChi", "name":"MaChungChi" },
                    { "data": "TenChungChi", "name": "TenChungChi" },
                    {
                        "data": "ThoiHan", "name": "ThoiHan", "render": function (data) {
                            return data + " năm";
                        }
                    },
                    { "data": "KieuChungChi", "name": "KieuChungChi" },
                     {"data": "MaChungChi", "render": function (data) {
                            return "<a class='waves-effect waves-light btn-small red modal-trigger' data-target='myedit' style='margin-left:5px' onclick=getEditId(" + data + ") ><i class=''></i> Edit</a>";
                    },
                    "orderable": false,
                    "searchable": false,
                    },
                    {
                    "data": "MaChungChi", "render": function (data) {
                        return "<a class='waves-effect waves-light btn-small red modal-trigger' data-target='mydelete' style='margin-left:5px' onclick=getDeleteId(" + data + ") ><i class='fa fa-trash'></i> Xóa</a>";
                    },
                    "orderable": false,
                    "searchable": false,
                },

                ],
                "language": {

                    "emptyTable": "No data found, Please click on <b>Add New</b> Button"
                },
                "autoWidth": false,

            });
            dataCertificateEmp = $("#table_cirt_emp").DataTable({
                "ajax": {
                    "url": "/phong-tcld/chung-chi/danh-sach-chung-chi-nhan-vien",
                    "type": "POST",
                    "datatype": "json",
                },
                "columns": [
                    { "data": "SoHieu", "name": "SoHieu" },
                    { "data": "TenNV", "name": "TenNV"  },
                    { "data": "TenChungChi", "name": "TenChungChi"  },
                    {"data": "NgayCap", "name": "NgayCap", "render": function (data) {
                            return dateFormat(data);
                        }
                    },
                    {
                        "data": "SoHieu", "render": function (data) {
                            return "<a class='waves-effect waves-light btn-small red modal-trigger' data-target='edit_employee'  style='margin-left:5px' onclick=getEditIdEmp('" + data + "') ><i class=''></i> Edit</a>";
                        },
                        "orderable": false,
                        "searchable": false,

                    },
                    {
                        "data": "SoHieu", "render": function (data) {
                            return "<a class='waves-effect waves-light btn-small red modal-trigger' data-target='delete_employee'  style='margin-left:5px' onclick=getDeleteIdEmp('" + data + "') ><i class='fa fa-trash'></i> Xóa</a>";
                        },
                        "orderable": false,
                        "searchable": false,
                    },

                ],
                "language": {

                    "emptyTable": "No data found, Please click on <b>Add New</b> Button"
                },
                "autoWidth": false,
            });
        });
        function dateFormat(d) {
            var dateString = d.substr(6);
            var currentTime = new Date(parseInt(dateString));
            var month = currentTime.getMonth() + 1;
            var day = currentTime.getDate();
            var year = currentTime.getFullYear();
            var date = day + "/" + month + "/" + year;
            return (date);
        }

        function SubmitForm(form) {
            $.validator.unobtrusive.parse(form);
            if ($(this).valid()) {
                $.ajax({
                    url: form.action,
                    type: "POST",
                    data: $(form).serialize(),
                    success: () => {
                        dataTable.ajax.reload();
                        $.notify(data.message, {
                            globalPosition: "top center",
                            className: "success"
                        });
                    },
                })
            }
            return false;
        }

        function SubmitFormEmployee(form) {
            $.validator.unobtrusive.parse(form);
            if ($(this).valid()) {
                $.ajax({
                    url: form.action,
                    type: "POST",
                    data: $(form).serialize(),
                    success: () => {
                        dataCertificateEmp.ajax.reload();
                        $.notify(data.message, {
                            globalPosition: "top center",
                            className: "success"
                        });
                    },
                })
            }
            return false;
        }


        function getDeleteIdEmp(idEmp) {
            deleteIdEmp = idEmp;
        }
        function DeleteEmp() {
            if (deleteIdEmp != null) {

                $.ajax({
                    type: "POST",
                    url: '@Url.Action("DeleteCertificateEmp", "Certificate")/' + deleteIdEmp,
                    success: function (data) {
                        if (data.success)
                        {
                            dataCertificateEmp.ajax.reload();
                            dataTable.ajax.reload();
                            $.notify(data.message, {
                                globalPosition: "top center",
                                className: "success"
                            })

                        }
                    }

                });
            }

        }

         function getDeleteId(id) {
            deleteId = id;
        }

        function Delete() {
            if (deleteId != null) {
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("DeleteCertificate", "Certificate")/' + deleteId,
                    success: function (data) {
                        if (data.success)
                        {
                            dataTable.ajax.reload();
                            dataCertificateEmp.ajax.reload();
                            $.notify(data.message, {
                                globalPosition: "top center",
                                className: "success"
                            })

                        }
                    }

                });
            }

        }

        function getEditId(id) {
            if (id != null) {
                $.ajax({
                    type: "GET",
                    url: '@Url.Action("EditCertificate", "Certificate")/' + id,
                    success: function (data) {
                        $("#edit-modal-body").html(data)
                    }

                });
            }

        }
        function getEditIdEmp(id) {
            if (id != null) {
                $.ajax({
                    type: "GET",
                    url: '@Url.Action("EditCertificateEmp", "Certificate")/' + id,
                    success: function (data) {
                        $("#edit-modal-body-emp").html(data)
                    }

                });
            }

        }
        function getSearchId() {
            searchId = $('#MaChungChi').val();

        }
        $("#searchButton").click(function () {
            if (searchId != null) {
                $.ajax({
                    type: "GET",
                    url: '@Url.Action("EditCertificate", "Certificate")/' + id,
                    success: function (data) {
                        $("#edit-modal-body").html(data)
                    }

                });
            }
        });

    </script>
}

