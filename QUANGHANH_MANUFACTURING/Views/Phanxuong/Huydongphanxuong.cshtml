@{
    ViewBag.Title = "Huydongphanxuong";
    Layout = "~/Views/Shared/_Layout_PhanXuong.cshtml";
}

<link href="~/assets/Custom css/CDVT/TABLE_BORDERED.css" rel="stylesheet" />
<link href="~/lib/datepicker_src/dist/css/datepicker.min.css" rel="stylesheet" type="text/css">
<link href="~/lib/datepicker_src/dist/css/datepicker.min.css " rel="stylesheet " type="text/css ">
<link href="~/lib/datepicker_src/dist/css/custom.css " rel="stylesheet " type="text/css ">
<link href="~/lib/datepicker_src/dist/css/font.css" rel="stylesheet" type="text/css">
<script src="~/lib/datepicker_src/dist/js/datepicker.js"></script>
<script src="~/lib/datepicker_src/dist/js/i18n/datepicker.vi.js"></script>
<link href="~/assets/Custom css/CDVT/TABLE_BORDERED.css" rel="stylesheet" />
<div class="card">
    <div class="card-content">
        <div class="container-fluid">
            <div class="row">
                <datalist id="IDlist">
                    @{
                        foreach (var item in ViewBag.listID)
                        {
                            <option value="@item"></option>
                        }
                    }
                </datalist>
                <datalist id="listid-s"></datalist>
                <datalist id="list-test1">
                    <option value="abcd">abcd</option>
                </datalist>
                <datalist id="list-test2">
                    <option value="abc">abc</option>
                </datalist>
                <div class="advanded-search">
                    <div class="row">
                        <h3 class="center"><b>HUY ĐỘNG THIẾT BỊ</b></h3>
                        <hr>
                        <div class="row center">
                            <div class="col l4 m4 s12">
                                <div class="row">
                                    <div class="col l10 m10 s12 input-field">
                                        <input type="text" list="IDlist" placeholder="Tìm kiếm theo mã thiết bị" name="id" class='form-control' id="equipmentId-search"
                                               multiple />


                                    </div>

                                </div>
                            </div>
                            <div class="col l4 m4 s12">
                                <div class="row">

                                    <div class="col l12 m12 s12 input-field m-t-25">
                                        <button class="btn blue darken-2 btn-small" id="searchButton1" onclick="research()">Tìm kiếm</button>
                                    </div>
                                </div>
                            </div>
                            <div class="col l4 m4 s12">
                                <div class="row">
                                    <div class="col l10 m10 s12 input-field">
                                        <input type="text" list="listid-s" placeholder="Tìm kiếm theo tên thiết bị" name="name" class='form-control' id="equipmentName-search"
                                               multiple />

                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="col l12 m12 s6">
                            <button class="btn blue darken-2 btn-small" id="searchButton2">Tìm kiếm</button>
                        </div>
                    </div>
                </div>

                <div id="chitiet">

                    <div class="col s12 table_container" id="table-wrapper2">
                        <table id="equipmentTable" class="table-bordered striped mytb">
                            <thead>
                                <tr>
                                    <th>Nhóm thiết bị</th>
                                    <th>Mã TSCĐ</th>
                                    <th>Tên thiết bị</th>
                                    <th>Số hiệu</th>
                                    <th>Số chế tạo</th>
                                    <th>Phân xưởng hiện tại</th>
                                    <th>Tình trạng hiện tại</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<ul id='dropdown1' class='dropdown-content'>
    <li><a class="dropdown-child" href="#!" name="lothien">Danh sách thiết bị lộ thiên</a></li>
    <li><a class="dropdown-child" href="#!" name="hamlo">Danh sách thiết bị hầm lò</a></li>
    <li><a class="dropdown-child" href="#!" name="baohiem">Danh sách hết bảo hiểm</a></li>
    <li><a class="dropdown-child" href="#!" name="khauhao">Danh sách hết khấu hao</a></li>
    <li><a class="dropdown-child" href="#!" name="baoduong">Danh sách đang bảo dưỡng</a></li>
    <li><a class="dropdown-child" href="#!" name="suachua">Danh sách đang sửa chữa</a></li>
    <li><a class="dropdown-child" href="#!" name="suco">Danh sách đang gặp sự cố</a></li>
    <li><a class="dropdown-child" href="#!" name="kiemdinh">Danh sách đang kiểm định</a></li>
    <li><a class="dropdown-child" href="#!" name="kiemdinh">Danh sách đang trung đại tu</a></li>
    <li><a class="dropdown-child" href="#!" name="kiemdinh">Danh sách các thiết bị dùng chung</a></li>
</ul>
<script src="~/js/Briefs_List.js"></script>
<script src="~/js/Custom JS/CDVT/Home/huydong.js"></script>
<link href="~/assets/Custom css/form-input-border.css" rel="stylesheet" />
<script src="~/js/Custom JS/CDVT/Home/DetailManu_Daily.js"></script>
<script>
    var check = true;

    $("#equipmentName-search").keyup(function (e) {
        if (e.which == 13) {
            $("#searchButton1").click();
            $("#person_created-search").blur();
        } else {
            var text = $("#equipmentName-search").val();
            $("#id-s").val(text);
            $("#ck").val("1");
            if (waittime > 1) {
                $("#ChangeIDForm").submit();
                waittime = 0;
            }
        }
    });
    $("#category-search").keyup(function (e) {
        if (e.which == 13) {
            $("#searchButton1").click();
            $("#date-start-search").blur()
        } else {
            var text = $("#category-search").val();
            $("#id-s").val(text);
            $("#ck").val("2");
            if (waittime > 1) {
                $("#ChangeIDForm").submit();
                waittime = 0;
            }
        }
    });
    $("#supplier-search").keyup(function (e) {
        if (e.which == 13) {
            $("#searchButton1").click();
            $("#date-end-search").blur();
        } else {
            var text = $("#supplier-search").val();
            $("#id-s").val(text);
            $("#ck").val("3");
            if (waittime > 1) {
                $("#ChangeIDForm").submit();
                waittime = 0;
            }
        }
    });
    $("#date-start-search").keyup(function (e) {
        if (e.which == 13) {
            $("#searchButton1").click();
            $("#date-start-search").blur()
        }
    });
    $("#date-end-search").keyup(function (e) {
        if (e.which == 13) {
            $("#searchButton1").click();
            $("#date-end-search").blur();
        }
    });

    $(window).resize(function () {
        if ($(window).width() <= 600) {
            $("#searchButton1").hide();
            $("#searchButton2").show();
        } else {
            $("#searchButton1").show();
            $("#searchButton2").hide();
        }
    });
    $('.Datemv').datepicker({
        language: 'vi'
    })
    $('.maxDate').datepicker({
        language: 'vi'
    })
    $('.maxDateAdd').datepicker({
        language: 'vi',
    })
    $('.minDate').datepicker({
        language: 'vi'
    })
    $(document).ready(function () {
        $('.datepicker-inline').remove();
        //var today = new Date();
        //var dd = today.getDate();
        //var mm = today.getMonth() + 1; //January is 0!

        //var yyyy = today.getFullYear();
        //if (dd < 10) {
        //    dd = '0' + dd;
        //}
        //if (mm < 10) {
        //    mm = '0' + mm;
        //}
        //var today = dd + '/' + mm + '/' + yyyy;
        //$(".minDate").each(function () {
        //    $(this).val(today);
        //});
        //today = new Date("1/1/1900");
        //var dd = today.getDate();
        //var mm = today.getMonth() + 1; //January is 0!

        //var yyyy = today.getFullYear();
        //if (dd < 10) {
        //    dd = '0' + dd;
        //}
        //if (mm < 10) {
        //    mm = '0' + mm;
        //}
        //var today = dd + '/' + mm + '/' + yyyy;
        //$(".maxDate").val(today)
    });



    $(document).ready(function () {
        $('input[required]').each(function myfunction() {
            $(this).attr("oninvalid", "setCustomValidity('Không được bỏ trống ô này')");
            $(this).attr("oninput", "this.setCustomValidity('')");
        })
    });
</script>

@section scripts{
    <script>
        var Popup, dataTable, bol, bol2;
        $(document).ready(function () {
            search();
        });
        function research() {
            dataTable.ajax.reload();
        }
        function search() {
            $("#pre-load").show();
            dataTable = $('#equipmentTable')
                .on('preXhr.dt', function (e, settings, data) {
                    ////////////////////////////////////HIỆN LÊN MỖI KHI CHẠY AJAX//////////////////////////////////
                    $("#pre-load").show("slow", function () {
                    });
                    $("#pre-load").css("z-index", "99999");
                    ////////////////////////////////////////////////////////////////////////
                })
                .DataTable({
                    "language": {
                        "equipmentTable": "Không tìm thấy dữ liệu"
                    },
                    "ajax": {
                        "url": "/phan-xuong/huy-dong-thiet-bi",
                        "type": "POST",
                        "search": false,
                        "datatype": "json",
                        "data": {
                            "equipmentId": function () {
                                return $('#equipmentId-search').val();
                            },
                            "equipmentName": function () {
                                return $('#equipmentName-search').val();
                            },
                            "dateStart": function () {
                                return $('#date-start-search').val();
                            },
                            "dateEnd": function () {
                                return $('#date-end-search').val();
                            }
                        },
                        "cache": false
                    },
                    "drawCallback": function (settings) {
                        ///////////////////////ẨN SAU MỖI AJAX CALL////////////////////////
                        $("#pre-load").hide("slow", function () {
                        });
                        ////////////////////////////////////////////////
                    },
                    "columns": [
                        { "data": "Equipment_category_name", "name": "Equipment_category_name" },
                        {
                            "data": "equipmentId", "name": "equipmentId", "render": function (data) {
                                return ("<form action=\"/phong-cdvt/thiet-bi\" method=\"post\"><input type=\"hidden\" name=\"id\" value=\"" + data + "\" class=\"form-control\"/><button class='btn' onclick='submit'>" + data + "</button></form>");
                            }
                        },
                        { "data": "equipment_name", "name": "equipment_name" },
                        { "data": "fabrication_number", "name": "fabrication_number" },
                        { "data": "mark_code", "name": "mark_code" },
                        { "data": "department_name", "name": "department_name" },
                        { "data": "statusname", "name": "statusname" },
                    ],

                    "serverSide": "true",
                    "order": [0, "asc"],
                    "rowId": "incident_id",
                    "lengthChange": false,
                    "searching": false,
                    "bInfo": false,
                    "initComplete": function (settings, json) {
                        $("#pre-load").hide("slow", function () {
                        });
                    }
                });

        }
        function dateFormat2(d) {
            var dateString = d.substr(6);
            var currentTime = new Date(parseInt(dateString));
            var month = currentTime.getMonth() + 1;
            var day = currentTime.getDate();
            var year = currentTime.getFullYear();
            var date = day + "/" + month + "/" + year;
            return (date);
        }
        function dateFormat(d) {
            console.log(d);
            return ((d.getMonth() + 1) + "").padStart(2, "0")
                + "/" + (d.getDate() + "").padStart(2, "0")
                + "/" + d.getFullYear();
        }


    </script>
}

